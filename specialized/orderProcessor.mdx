---
title: Order Processor Agent
$type: Agent
name: Order Processor Agent
description: Automated order validation, fraud detection, and fulfillment coordination

capabilities:
  - order-validation
  - fraud-detection
  - inventory-checking
  - payment-processing
  - fulfillment-coordination

model:
  provider: anthropic
  model: claude-3-5-sonnet-20241022
  temperature: 0.2

systemPrompt: |
  You are an order processing agent. Your responsibilities:
  1. Validate order details (items, quantities, addresses)
  2. Check inventory availability across warehouses
  3. Detect fraudulent orders using risk scoring
  4. Calculate accurate totals with tax and shipping
  5. Coordinate fulfillment with warehouse systems
  6. Handle exceptions and errors gracefully

functions:
  - validate-order
  - check-inventory
  - calculate-totals
  - detect-fraud
  - route-to-warehouse
  - update-order-status

memory:
  type: conversation
  maxTokens: 12000

integrations:
  - inventory-system
  - payment-gateway
  - fraud-detection-service
  - warehouse-management
  - customer-database
---

# Order Processor Agent

An AI agent that validates, processes, and coordinates e-commerce orders with fraud detection and inventory management.

## Core Validation

The agent performs multi-stage validation:

**Stage 1: Data Validation**
- Email format and domain verification
- Phone number format validation
- Address completeness check
- SKU existence verification

**Stage 2: Inventory Check**
- Query available stock by warehouse
- Check for sufficient quantity
- Validate product combinations
- Confirm backorder status

**Stage 3: Fraud Detection**
- Shipping/billing address mismatch
- High-value first-time orders
- Velocity checks (multiple orders/hour)
- IP geolocation vs shipping address
- Email domain reputation

**Stage 4: Payment Validation**
- Credit card format
- Available payment methods
- Amount calculation verification
- Currency validation

## Fraud Scoring Algorithm

**Risk Score (0-100):**

```yaml
fraudScore:
  addressMismatch: 40 points
  firstTimeHighValue: 30 points (>$500)
  velocityAnomaly: 25 points (>3 orders/hour)
  suspiciousIP: 20 points
  emailRiskDomain: 15 points
  unusualShippingDestination: 10 points
```

**Action Thresholds:**
- **0-30** - Auto-approve
- **31-60** - Manual review
- **61-100** - Auto-decline

## Order Processing Flow

```
Receive Order
  ↓
Validate Data → If invalid → Return error
  ↓
Check Inventory → If out of stock → Backorder or cancel
  ↓
Calculate Totals (items + tax + shipping)
  ↓
Fraud Check → If high risk → Flag for review
  ↓
Process Payment → If declined → Retry or cancel
  ↓
Route to Warehouse (closest with stock)
  ↓
Confirm Order → Send confirmation email
  ↓
Update Status → Monitoring until delivery
```

## Tax Calculation

**Sales Tax Rules:**
- Query tax rate by destination ZIP code
- Apply state, county, city rates
- Handle tax-exempt customers
- Support international VAT

**Shipping Cost:**
- Weight-based calculation
- Dimensional weight consideration
- Carrier selection (cheapest/fastest)
- Free shipping thresholds

## Warehouse Routing

**Selection Criteria:**
1. Inventory availability
2. Distance to customer
3. Warehouse capacity
4. Shipping cost optimization
5. Historical performance

**Multi-Warehouse Orders:**
- Split shipments when needed
- Minimize shipping costs
- Coordinate timing
- Single tracking number per shipment

## Error Handling

**Common Issues:**

**Out of Stock:**
- Check alternative warehouses
- Offer backorder option
- Suggest similar products
- Update customer automatically

**Payment Declined:**
- Retry with exponential backoff
- Request alternate payment method
- Hold order for 24 hours
- Auto-cancel if unresolved

**Invalid Address:**
- Attempt address validation API
- Suggest corrections
- Request customer confirmation
- Prevent shipment until resolved

## Performance Metrics

**Order Processing:**
- **Processing Time** - Average order completion time
- **Accuracy Rate** - % orders without errors
- **Fraud Detection** - False positive rate
- **Customer Satisfaction** - Order issue resolution rate

**Targets:**
- <2 minutes average processing
- 99.5%+ accuracy
- <5% false positives
- 95%+ CSAT score

## Integration Points

**Inventory System:**
- Real-time stock queries
- Multi-location availability
- Reserve items during checkout

**Payment Gateway:**
- Stripe, Braintree, PayPal
- Tokenized card storage
- 3D Secure support

**Fraud Detection:**
- Sift, Signifyd, or Kount
- Real-time risk scoring
- Transaction velocity tracking

**Warehouse Management:**
- Order routing by rules
- Pick/pack/ship coordination
- Status updates and tracking

## Related

- [[inventory-clerk-agent.mdx|Inventory Clerk Agent]]
- [[shipping-coordinator-agent.mdx|Shipping Coordinator Agent]]
- [[processOrder.mdx|Process Order Workflow]]
- [[validateOrder.mdx|Validate Order Function]]
- [[ShopifyOrders.mdx|Shopify Integration]]
- [[stripe-webhooks-integration.mdx|Stripe Webhooks]]
